<script data-goatcounter="https://{{ site.goat_counter }}.goatcounter.com/count"
        data-goatcounter-settings='{"no_onload": true}'
        async src="//gc.zgo.at/count.js"></script>

<!-- í˜ì´ì§€ë³„ ì¡°íšŒìˆ˜ í‘œì‹œë¥¼ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  // ì„¸ì…˜ ê¸°ë°˜ ë°©ë¬¸ì ì¶”ì 
  function trackUniqueVisit() {
    const sessionKey = 'visited_' + window.location.pathname;
    const hasVisited = sessionStorage.getItem(sessionKey);
    
    if (!hasVisited) {
      // ì„¸ì…˜ì—ì„œ ë°©ë¬¸í•˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ì¹´ìš´íŒ…
      if (window.goatcounter) {
        window.goatcounter.count({
          path: window.location.pathname,
          title: document.title
        });
      }
      sessionStorage.setItem(sessionKey, 'true');
    }
  }
  
  // Goat Counter APIë¥¼ ì‚¬ìš©í•˜ì—¬ í˜ì´ì§€ë³„ ì¡°íšŒìˆ˜ ê°€ì ¸ì˜¤ê¸°
  async function loadPageViews() {
    const pageviewElements = document.querySelectorAll('[data-goatcounter-url]');
    
    for (const element of pageviewElements) {
      const url = element.getAttribute('data-goatcounter-url');
      const path = new URL(url).pathname;
      
      try {
        // Goat Counter API í˜¸ì¶œ
        const response = await fetch(`https://{{ site.goat_counter }}.goatcounter.com/api/v0/stats/path?path=${encodeURIComponent(path)}`);
        if (response.ok) {
          const data = await response.json();
          if (data && data.stats && data.stats.length > 0) {
            const pageViews = data.stats[0].count;
            element.textContent = pageViews.toLocaleString();
          } else {
            element.textContent = '0';
          }
        } else {
          element.textContent = 'ğŸ“Š';
        }
      } catch (error) {
        // CORS ì´ìŠˆë‚˜ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ í‘œì‹œ
        element.textContent = 'ğŸ“Š';
      }
    }
  }
  
  // í˜ì´ì§€ ë¡œë“œ í›„ ì‹¤í–‰
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      trackUniqueVisit();
      loadPageViews();
    });
  } else {
    trackUniqueVisit();
    loadPageViews();
  }
</script>

<noscript>
  <img src="https://{{ site.goat_counter }}.goatcounter.com/count?p=/test-img">
</noscript>